@section Scripts {
    <script src="~/js/personas.js"></script>
}

<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active text-dark" id="home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Ver Usuarios</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link text-dark" id="add-tab" data-bs-toggle="tab" data-bs-target="#nav-add" type="button" role="tab" aria-controls="nav-add" aria-selected="false">Agregar Usuario</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link text-dark" id="search-tab" data-bs-toggle="tab" data-bs-target="#nav-search" type="button" role="tab" aria-controls="nav-search" aria-selected="false">Buscar Usuario</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link text-dark" id="add-m-tab" data-bs-toggle="tab" data-bs-target="#nav-add-m" type="button" role="tab" aria-controls="nav-add-m" aria-selected="false">Agregar Usuario Masivo</button>
    </li>
</ul>

<div class="tab-content" id="nav-tabContent">

    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="home-tab" tabindex="0">

        <div class="container mt-4">

            <table id="tabla-persona" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Cédula</th>
                        <th>Nombres</th> 
                        <th>Edad</th>
                        <th>Género</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se cargarán los registros de personas -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- TAB para AGREGAR -->
    <div class="tab-pane fade" id="nav-add" role="tabpanel" aria-labelledby="add-tab" tabindex="0">
        <div class=" card mx-2 p4 container mt-4">
            <form id="personaForm" class="px-3 py-3" novalidate onsubmit="return savePersona(event)">
                <div class="row">
                    <!-- Primera fila: Cédula, Edad, Género -->
                    <div class="col-md-4 mb-3 position-relative">
                        <label for="cedula" class="form-label">Cédula</label>
                        <input  pattern="[0-9]{10}" maxlength="10" type="text" id="cedula" class="form-control" placeholder="Ingrese la cédula" required>
                      
                    </div>
                    <div class="col-md-4 mb-3 position-relative">
                        <label for="edad" class="form-label">Edad</label>
                        <input min="0" max="120" type="number" id="edad" class="form-control" placeholder="Ingrese la edad" required>
                    
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="genero" class="form-label">Género</label>
                        <select id="genero" class="form-select" required>
                            <option value="M">Masculino</option>
                            <option value="F">Femenino</option>
                        </select>
                        <div class="invalid-tooltip">Selecciona un género</div>
                    </div>
                </div>

                <!-- Segunda fila: Nombres, Apellidos -->
                <div class="row">
                    <div class="col-md-6 mb-3 position-relative">
                        <label for="nombres" class="form-label">Nombres</label>
                        <input maxlength="35 type=" text" id="nombres" class="form-control" placeholder="Ingrese los nombres" required>
                
                    </div>
                    <div class="col-md-6 mb-3 position-relative">
                        <label for="apellidos" class="form-label">Apellidos</label>
                        <input maxlength="35 type="text" id="apellidos" class="form-control" placeholder="Ingrese los apellidos" required>
                     
                    </div>
                </div>

                <!-- Tercera fila: Email, Contraseña, Rol -->
                <div class="row">
                    <div class="col-md-4 mb-3 position-relative">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" class="form-control" placeholder="Ingrese el email" required>
              
                    </div>
                    <div class="col-md-4 mb-3 position-relative">
                        <label for="clave" class="form-label">Asignacion automatica Contraseña</label>
                        <input type="text" id="clave" class="form-control" placeholder="Ingrese la contraseña" disabled>
                    </div>
                    <div class="col-md-4 mb-3 position-relative">
                        <label for="idRol" class="form-label">Rol</label>
                        <select id="idRol" class="form-select" required>
                            <option value="">Seleccione un rol</option>
                        </select> 
                    </div>
                </div>

                <!-- Campo oculto: Usuario Ingreso -->
                <div class="row">
                    <div class="col-md-3 position-relative" style="display: none;">
                        <label for="usuarioIngreso" class="form-label">Usuario Ingreso</label>
                        <input type="text" class="form-control" id="usuarioIngreso" disabled>
                    </div>
                </div>

                <!-- Botones -->
                <div class="col-12 d-flex mb-2 justify-content-center">
                    <button type="submit" class="btn btn-primary me-3">Guardar</button>
                    <button class="btn btn-danger" type="button" onclick="resetPersonaForm(event)">Limpiar</button>
                </div>
            </form>

        </div>

    </div>

    <div class="tab-pane fade" id="nav-search" role="tabpanel" aria-labelledby="search-tab" tabindex="0">
        <center>
            <div class="p-3 w-50 my-2 bg-white shadow-sm">
                <label for="buscar-persona" class="form-label">
                    Buscar por cédula
                </label>
                <div class="input-group my-2">
                    <input type="text" id="buscar-persona" class="form-control form-control-sm" placeholder="Ingresa la cédula" required>
                    <button class="btn btn-primary" type="button" onclick="BuscarPersona()">Buscar</button>
                </div>
            </div>
            <div class="card mx-2 my-2 p-3 shadow">
                <form id="form-persona">
                    <div class="row g-3">
                        <div class="col-6">
                            <label for="persona-nombres" class="form-label">Nombres</label>
                            <input type="text" id="persona-nombres" class="form-control" disabled readonly>
                        </div>
                        <div class="col-6">
                            <label for="persona-apellidos" class="form-label">Apellidos</label>
                            <input type="text" id="persona-apellidos" class="form-control" disabled readonly>
                        </div>
                        <div class="col-4">
                            <label for="persona-cedula" class="form-label">Cédula</label>
                            <input type="text" id="persona-cedula" class="form-control" disabled readonly>
                        </div>
                        <div class="col-4">
                            <label for="persona-edad" class="form-label">Edad</label>
                            <input type="number" id="persona-edad" class="form-control" disabled  readonly>
                        </div>
                        <div class="col-4">
                            <label for="persona-genero" class="form-label">Género</label>
                            <input type="text" id="persona-genero" class="form-control" disabled  readonly>
                        </div>
                        <div class="col-4">
                            <label for="persona-email" class="form-label">Correo Electrónico</label>
                            <input type="email" id="persona-email" class="form-control" disabled readonly>
                        </div>
                        <div class="col-4">
                            <label for="persona-rol" class="form-label">Rol</label>
                            <input type="text" id="persona-rol" class="form-control" disabled readonly>
                        </div>
                        <div class="col-4">
                            <label for="persona-usuario-ingreso" class="form-label">Usuario Ingreso</label>
                            <input type="text" id="persona-usuario-ingreso" class="form-control" disabled readonly>
                        </div>
                        <div class="col-4">
                            <label for="persona-usuario-actualizacion" class="form-label">Usuario Actualización</label>
                            <input type="text" id="persona-usuario-actualizacion" class="form-control" disabled readonly>
                        </div>
                        <div class="col-3">
                            <label for="persona-fecha-creacion" class="form-label">Fecha de Creación</label>
                            <input type="text" id="persona-fecha-creacion" class="form-control" disabled readonly>
                        </div>
                        <div class="col-3">
                            <label for="persona-fecha-modificacion" class="form-label">Fecha de Modificación</label>
                            <input type="text" id="persona-fecha-modificacion" class="form-control" disabled readonly>
                        </div>
                    </div>
                </form>
            </div>
        </center>

    </div>
    <div class="tab-pane fade" id="nav-add-m" role="tabpanel" aria-labelledby="add-m-tab" tabindex="0">
        <div class="card p-4">
            <h5 class="card-title">Carga Masiva de Estudiantes</h5>
            <p class="card-text">
                Seleccione un archivo CSV para cargar los datos de matriculación de estudiantes de forma masiva.
                Asegúrese de que el archivo cumpla con el formato especificado.
            </p>
            <div class="input-group mb-3">
                <input type="file" class="form-control" id="inputCsvFile" accept=".csv" aria-label="Cargar archivo CSV" aria-describedby="uploadCsvButton">
                <button class="btn btn-outline-primary" type="button" onclick="procesarArchivoCSV(event)">Procesar archivo</button>
            </div>
            <p class="small text-muted">
                Descargue un archivo de ejemplo con el formato requerido para la carga masiva:
                <a href="~/docs/Formato_Carga_Masiva.csv" download="Formato_Carga_Masiva.csv">Descargar formato</a>
            </p>
        </div>
    </div>


</div>
<!--Modal para Eliminar Persona-->
<div class="modal fade" id="confirmarEliminacionModal" tabindex="-1" aria-labelledby="confirmarEliminacionLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmarEliminacionLabel">Confirmar Eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ¿Está seguro que desea eliminar este usuario?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" onclick="confirmarEliminacionPersona()">Eliminar</button>
            </div>
        </div>
    </div>
</div>


<!--Modal para Editar Persona-->
<div class="modal fade" id="modal-editar-persona" tabindex="-1" aria-labelledby="modal-editar-persona-label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-editar-persona-label">Editar Persona</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-6">
                        <label for="editar-persona-cedula" class="form-label">Cédula</label>
                        <input type="text" class="form-control" id="editar-persona-cedula" readonly placeholder="Ingresa la cédula">
                    </div>
                    <div class="col-6">
                        <label for="editar-persona-nombres" class="form-label">Nombres</label>
                        <input type="text" class="form-control" id="editar-persona-nombres" placeholder="Ingresa los nombres">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-6">
                        <label for="editar-persona-apellidos" class="form-label">Apellidos</label>
                        <input type="text" class="form-control" id="editar-persona-apellidos" placeholder="Ingresa los apellidos">
                    </div>

                    <div class="col-6">
                        <label for="editar-persona-email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editar-persona-email" placeholder="Ingresa el correo electrónico">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-3">
                        <label for="editar-persona-genero" class="form-label">Género</label>
                        <select class="form-control" id="editar-persona-genero">
                            <option value="M">Masculino</option>
                            <option value="F">Femenino</option>
                            <option value="O">Otro</option>
                        </select>
                    </div>

                    <div class="col-3">
                        <label for="editar-persona-edad" class="form-label">Edad</label>
                        <input type="number" class="form-control" id="editar-persona-edad" placeholder="Ingresa la edad">
                    </div>

                    <div class="col-3">
                        <label for="editar-persona-rol" class="form-label">Rol</label>
                        <select id="editar-persona-rol" class="form-select" required>
                            <option value="">Seleccione un rol</option>
                        </select>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-3">
                        <label for="editar-estadopersona" class="form-label">Estado</label>
                        <select id="editar-estadopersona" class="form-select" required>
                            <option value="ACT">Activar</option>
                            <option value="INA">Inactivar</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <label for="editar-userIngreso" class="form-label">Usuario Ingreso</label>
                        <input type="text" class="form-control" id="editar-userIngreso" readonly placeholder="Ingresa el correo electrónico" disabled>
                    </div>
                    <div class="col-4">
                        <label for="editar-userIngreso" class="form-label">Usuario Actualizacion</label>
                        <input type="text" class="form-control" id="editar-userActualizar" readonly placeholder="Ingresa el correo electrónico" disabled>
                    </div>
                </div>
            </div>
            <div class="modal-footer col-12 d-flex mb-2 justify-content-center">
                <button type="button" class="btn btn-primary" id="btn-guardar-cambios" onclick="confirmarEditarPersona()">Guardar</button>
                <button type="button" class="btn btn-secondary me-3" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal para mostrar resultados -->
<div class="modal fade" id="modalResultados" tabindex="-1" aria-labelledby="modalResultadosLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Resultados de la Matriculación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>Matriculados con éxito:</h6>
                <ul id="listaExitosos" class="list-group list-group-flush"></ul>
                <h6 class="mt-3">Errores:</h6>
                <ul id="listaErrores" class="list-group list-group-flush"></ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<script src="~/js/personas.js" asp-append-version="true"></script>